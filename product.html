<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Loading product...</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
  <style>
    /* Additional styles for product details layout */
    main {
      max-width: 900px;
      margin: 80px auto 60px;
      padding: 0 20px;
      display: flex;
      gap: 40px;
      color: #eee;
    }
    .image-gallery {
      flex: 1 1 400px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    #mainImage {
      width: 100%;
      border-radius: 12px;
      object-fit: contain;
      max-height: 500px;
      background: #222;
    }
    .thumbnail-row {
      display: flex;
      gap: 10px;
      overflow-x: auto;
      padding-bottom: 5px;
    }
    .thumbnail {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 10px;
      cursor: pointer;
      border: 2px solid transparent;
      transition: border-color 0.3s;
      flex-shrink: 0;
    }
    .thumbnail.selected {
      border-color: #4caf50;
    }
    .product-info {
      flex: 1 1 400px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .product-info h2 {
      color: #4caf50;
      font-weight: 600;
      font-size: 2rem;
    }
    .product-info p {
      line-height: 1.4;
    }
    .product-info strong {
      color: #4caf50;
    }
    #addToCartBtn {
      margin-top: 20px;
      padding: 12px 20px;
      background-color: #4caf50;
      color: #111;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    #addToCartBtn:hover {
      background-color: #388e3c;
    }
    /* Cart icon styles */
    .cart-icon {
      cursor: pointer;
      font-weight: 600;
      color: white;
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 1.2rem;
      user-select: none;
      position: relative;
    }
    .cart-count {
      position: absolute;
      top: -6px;
      right: -10px;
      background: #4caf50;
      color: #111;
      border-radius: 50%;
      font-size: 0.75rem;
      width: 18px;
      height: 18px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: 700;
    }

    /* Responsive */
    @media (max-width: 768px) {
      main {
        flex-direction: column;
        margin-top: 70px;
      }
      .image-gallery, .product-info {
        flex: none;
        width: 100%;
      }
      #mainImage {
        max-height: 350px;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>
      SoleZone
      <span>Premium trainers from leading brands</span>
    </h1>
    <nav>
      <a href="index.html">Home</a>
      <a href="stock.html">Stock</a>
      <a href="contact.html">Contact</a>
      <div id="cartIcon" class="cart-icon" title="View cart">
        ðŸ›’
        <span id="cartCount" class="cart-count">0</span>
      </div>
    </nav>
  </header>

  <main>
    <div class="image-gallery" id="imageGallery">
      <!-- Main image and thumbnails inserted here -->
    </div>
    <div class="product-info" id="productInfo">
      <!-- Product info inserted here -->
    </div>
  </main>

  <script>
    // Utility: get product name from URL like ?product=air-max-90
    function getQueryParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }

    const productSlug = getQueryParam('product');
    const imageGallery = document.getElementById('imageGallery');
    const productInfo = document.getElementById('productInfo');
    const cartCountEl = document.getElementById('cartCount');
    const cartIcon = document.getElementById('cartIcon');

    // Cart from localStorage or empty
    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    updateCartCount();

    if (!productSlug) {
      productInfo.innerHTML = '<p>Invalid product.</p>';
      document.title = 'Product Not Found';
    } else {
      fetch('shoes.json')
        .then(res => {
          if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
          return res.json();
        })
        .then(data => {
          // Normalize products: add slug from title (slugify)
          const products = data.map(item => ({
            ...item,
            slug: slugify(item.title),
            priceNum: parseFloat(item.price.replace('Â£', '')) || 0,
            images: item.images.length ? item.images : ['images/placeholder.jpg']
          }));

          // Find product by slug
          const product = products.find(p => p.slug === productSlug);

          if (!product) {
            productInfo.innerHTML = '<p>Product not found.</p>';
            document.title = 'Product Not Found';
            return;
          }

          document.title = product.title + ' - SoleZone';
          renderProduct(product);
        })
        .catch(err => {
          console.error('Failed to load shoes.json:', err);
          productInfo.innerHTML = '<p>Failed to load product data.</p>';
          document.title = 'Error Loading Product';
        });
    }

    function slugify(text) {
      return text.toString().toLowerCase()
        .replace(/\s+/g, '-')      // Replace spaces with -
        .replace(/[^\w\-]+/g, '')  // Remove all non-word chars
        .replace(/\-\-+/g, '-')    // Replace multiple - with single -
        .replace(/^-+/, '')        // Trim - from start of text
        .replace(/-+$/, '');       // Trim - from end of text
    }

    function renderProduct(product) {
      // Show main image + thumbnails
      let mainImgSrc = product.images[0];
      imageGallery.innerHTML = `
        <img id="mainImage" src="${mainImgSrc}" alt="${product.title} main image" />
        <div class="thumbnail-row">
          ${product.images.map((img, i) =>
            `<img src="${img}" alt="Thumbnail ${i + 1}" class="thumbnail${i === 0 ? ' selected' : ''}" data-src="${img}" />`
          ).join('')}
        </div>
      `;

      // Thumbnail click swap
      const thumbnails = imageGallery.querySelectorAll('.thumbnail');
      const mainImageEl = document.getElementById('mainImage');
      thumbnails.forEach(thumb => {
        thumb.addEventListener('click', () => {
          mainImageEl.src = thumb.dataset.src;
          thumbnails.forEach(t => t.classList.remove('selected'));
          thumb.classList.add('selected');
        });
      });

      // Show product details
      productInfo.innerHTML = `
        <h2>${product.title}</h2>
        <p><strong>Price:</strong> Â£${product.priceNum.toFixed(2)}</p>
        <p><strong>Size:</strong> ${product.info.size}</p>
        <p><strong>Condition:</strong> ${product.info.condition}</p>
        <p><strong>Color:</strong> ${product.info.color}</p>
        <p><strong>Material:</strong> ${product.info.material}</p>
        <p><strong>Shipping:</strong> ${product.info.shipping}</p>
        <p><strong>Box:</strong> ${product.info.box}</p>
        <p><strong>Authenticity:</strong> ${product.info.authenticity}</p>
        <a href="${product.buyLink}" class="buy-link" target="_blank" rel="noopener noreferrer">Buy Now</a>
        <button id="addToCartBtn">Add to Cart</button>
      `;

      document.getElementById('addToCartBtn').addEventListener('click', () => addToCart(product));
    }

    function updateCartCount() {
      cartCountEl.textContent = cart.length;
    }

    function addToCart(product) {
      // Check if already in cart (by slug)
      const exists = cart.some(item => item.slug === product.slug);
      if (!exists) {
        cart.push({
          slug: product.slug,
          title: product.title,
          price: product.priceNum,
          qty: 1,
          image: product.images[0]
        });
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartCount();
        alert(`Added "${product.title}" to cart!`);
      } else {
        alert(`"${product.title}" is already in your cart.`);
      }
    }

    cartIcon.addEventListener('click', () => {
      if (cart.length === 0) {
        alert('Your cart is empty.');
        return;
      }
      let cartSummary = 'Your Cart:\n\n';
      cart.forEach((item, i) => {
        cartSummary += `${i + 1}. ${item.title} â€” Â£${item.price.toFixed(2)} x${item.qty}\n`;
      });
      alert(cartSummary);
    });
  </script>
</body>
</html>
